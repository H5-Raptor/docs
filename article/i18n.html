<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>多语言 | H5-Raptor</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/docs/favicon.ico">
    <meta name="description" content="H5 组件化中台">
    
    <link rel="preload" href="/docs/assets/css/1.styles.dee47e69.css" as="style"><link rel="preload" href="/docs/assets/js/app.b00f8d5a.js" as="script"><link rel="preload" href="/docs/assets/js/3.9b2ede99.js" as="script"><link rel="preload" href="/docs/assets/js/21.5e880656.js" as="script"><link rel="prefetch" href="/docs/assets/js/0.27ee81e5.js"><link rel="prefetch" href="/docs/assets/js/10.d856b5d0.js"><link rel="prefetch" href="/docs/assets/js/11.86b6272a.js"><link rel="prefetch" href="/docs/assets/js/12.e3bce49f.js"><link rel="prefetch" href="/docs/assets/js/13.250406cb.js"><link rel="prefetch" href="/docs/assets/js/14.025c88c1.js"><link rel="prefetch" href="/docs/assets/js/15.f45af96c.js"><link rel="prefetch" href="/docs/assets/js/16.fa6b1d6c.js"><link rel="prefetch" href="/docs/assets/js/17.82d92ac1.js"><link rel="prefetch" href="/docs/assets/js/18.b20542eb.js"><link rel="prefetch" href="/docs/assets/js/19.51bcd2d6.js"><link rel="prefetch" href="/docs/assets/js/20.5f2e3651.js"><link rel="prefetch" href="/docs/assets/js/22.62073fd1.js"><link rel="prefetch" href="/docs/assets/js/23.c29c1c9c.js"><link rel="prefetch" href="/docs/assets/js/24.2953c591.js"><link rel="prefetch" href="/docs/assets/js/25.b660c849.js"><link rel="prefetch" href="/docs/assets/js/26.06f598ac.js"><link rel="prefetch" href="/docs/assets/js/27.b4c87f0b.js"><link rel="prefetch" href="/docs/assets/js/28.eef3712a.js"><link rel="prefetch" href="/docs/assets/js/29.b7b32fce.js"><link rel="prefetch" href="/docs/assets/js/30.59dc80e0.js"><link rel="prefetch" href="/docs/assets/js/31.7bbdd15c.js"><link rel="prefetch" href="/docs/assets/js/32.2be2d742.js"><link rel="prefetch" href="/docs/assets/js/33.7d6b8213.js"><link rel="prefetch" href="/docs/assets/js/34.e02bbe67.js"><link rel="prefetch" href="/docs/assets/js/35.4180d0df.js"><link rel="prefetch" href="/docs/assets/js/36.956e34a9.js"><link rel="prefetch" href="/docs/assets/js/37.e081b47e.js"><link rel="prefetch" href="/docs/assets/js/38.fc039be2.js"><link rel="prefetch" href="/docs/assets/js/39.07f4aed4.js"><link rel="prefetch" href="/docs/assets/js/4.1a4ae924.js"><link rel="prefetch" href="/docs/assets/js/40.58a3f5c9.js"><link rel="prefetch" href="/docs/assets/js/41.94cfa0d0.js"><link rel="prefetch" href="/docs/assets/js/42.287e2d4e.js"><link rel="prefetch" href="/docs/assets/js/43.e1e6a639.js"><link rel="prefetch" href="/docs/assets/js/44.8a3d4800.js"><link rel="prefetch" href="/docs/assets/js/45.44ace13e.js"><link rel="prefetch" href="/docs/assets/js/5.ea661ddb.js"><link rel="prefetch" href="/docs/assets/js/6.0f38b22e.js"><link rel="prefetch" href="/docs/assets/js/7.4a2e8031.js"><link rel="prefetch" href="/docs/assets/js/8.4f3c4d0e.js"><link rel="prefetch" href="/docs/assets/js/9.a0567a0b.js">
    <link rel="stylesheet" href="/docs/assets/css/1.styles.dee47e69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/logo.png" alt="H5-Raptor" class="logo"> <span class="site-name can-hide">H5-Raptor</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/guide/" class="nav-link">
  使用指南
</a></div><div class="nav-item"><a href="http://www.h5raptor.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  H5-Raptor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/h5-raptor/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/guide/" class="nav-link">
  使用指南
</a></div><div class="nav-item"><a href="http://www.h5raptor.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  H5-Raptor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/h5-raptor/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>使用指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/guide/" class="sidebar-link">介绍</a></li><li><a href="/docs/guide/glossary.html" class="sidebar-link">名词解释</a></li><li><a href="/docs/guide/preparation.html" class="sidebar-link">业务接入</a></li><li><a href="/docs/guide/quick-start.html" class="sidebar-link">快速搭建</a></li><li><a href="/docs/guide/manage.html" class="sidebar-link">深入管理</a></li><li><a href="/docs/guide/advance-usage.html" class="sidebar-link">进阶操作</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/dev/" class="sidebar-link">说明</a></li><li><a href="/docs/dev/component.html" class="sidebar-link">组件</a></li><li><a href="/docs/dev/JSON-Schema.html" class="sidebar-link">JSON-Schema</a></li><li><a href="/docs/dev/layout-component.html" class="sidebar-link">组件嵌套</a></li><li><a href="/docs/dev/communication.html" class="sidebar-link">组件通信</a></li><li><a href="/docs/dev/i18n.html" class="sidebar-link">多语言</a></li><li><a href="/docs/dev/theme-color.html" class="sidebar-link">主题色</a></li><li><a href="/docs/dev/plugin.html" class="sidebar-link">插件</a></li><li><a href="/docs/dev/publish.html" class="sidebar-link">组件发布</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/design/size.html" class="sidebar-link">尺寸规范</a></li><li><a href="/docs/design/theme-color.html" class="sidebar-link">主题色</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高阶指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/advanced/code.html" class="sidebar-link">自定义代码</a></li><li><a href="/docs/advanced/utils-plugin.html" class="sidebar-link">utils 与 plugin</a></li><li><a href="/docs/advanced/build-template.html" class="sidebar-link">编译模板</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入理解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/proficient/component-base.html" class="sidebar-link">组件与素材库</a></li><li><a href="/docs/proficient/framework.html" class="sidebar-link">多框架支持</a></li><li><a href="/docs/proficient/custom-render.html" class="sidebar-link">自定义渲染</a></li><li><a href="/docs/proficient/theme.html" class="sidebar-link">主题色</a></li><li><a href="/docs/proficient/communication.html" class="sidebar-link">组件/插件间通信</a></li><li><a href="/docs/article/i18n.html" aria-current="page" class="active sidebar-link">多语言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/article/i18n.html#一、背景、历史演变" class="sidebar-link">一、背景、历史演变</a></li><li class="sidebar-sub-header"><a href="/docs/article/i18n.html#二、h5-raptor-实现" class="sidebar-link">二、H5-Raptor 实现</a></li><li class="sidebar-sub-header"><a href="/docs/article/i18n.html#三、小结" class="sidebar-link">三、小结</a></li><li class="sidebar-sub-header"><a href="/docs/article/i18n.html#示例" class="sidebar-link">示例</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常见问题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/question/" class="sidebar-link">问题汇总</a></li><li><a href="/docs/question/build.html" class="sidebar-link">业务自定义编译</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="多语言"><a href="#多语言" class="header-anchor">#</a> 多语言</h1> <p>本篇为记录性质的文章。</p> <h2 id="一、背景、历史演变"><a href="#一、背景、历史演变" class="header-anchor">#</a> 一、背景、历史演变</h2> <h4 id="_1-1-word-文档整理汇总"><a href="#_1-1-word-文档整理汇总" class="header-anchor">#</a> 1.1 Word 文档整理汇总</h4> <p>在前某公司，由于翻译（区域运营）同学分布在海外，运营活动的多语言文案都是本地运营先整理中文 word 版本，分发给区域运营，待翻译完后收集并整理交给开发，开发者将文案编写进 json 语言包。</p> <h4 id="_1-2-在线-excel-协同编辑"><a href="#_1-2-在线-excel-协同编辑" class="header-anchor">#</a> 1.2 在线 Excel 协同编辑</h4> <p>从 Word 文档摘取文案，手动编写 json 包的效率低下，同时会因为来回修改文案而十分折腾人，考虑到地区不同和多人编辑，调整为在线 excel 协同编辑，这样免去了运营再整理的麻烦。</p> <p>给出第一列中文文案及其他列的语言码，剩下交给翻译和开发即可。</p> <table><thead><tr><th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>今年过节不收礼</td> <td>Free America</td> <td></td></tr> <tr><td>收礼只收脑白金</td> <td>shooting every day</td> <td></td></tr></tbody></table> <h4 id="_1-3-脚本转-excel-为-json-语言包"><a href="#_1-3-脚本转-excel-为-json-语言包" class="header-anchor">#</a> 1.3 脚本转 Excel 为 JSON 语言包</h4> <p>本地运营解放后，开发也着手提效，手动 copy 文案的方式绝不是技术能接受的。在观摩 Excel 表格结构后，开发想了个办法，把表格第一列当做 json 的 key名，其他列当做该 key 的 value 值。</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>title</td> <td>今年过节不收礼</td> <td>Free America</td> <td>заглавие</td></tr> <tr><td>subtitle</td> <td>收礼只收脑白金</td> <td>shooting every day</td> <td>содержание</td></tr></tbody></table> <p>按以上设计编写脚本，将表格转换成 json, 破费~</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cn&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;今年过节不收礼&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subtitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;收礼只收脑白金&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Free America&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subtitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shooting every day&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ru&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;заглавие&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subtitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;содержание&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="_1-4-列表问题"><a href="#_1-4-列表问题" class="header-anchor">#</a> 1.4 列表问题</h4> <p>好景不长，很快遇到了<code>列表问题</code>，比如一些规则、步骤说明，一开始无法确定有多少句，并且不同地域规则说明可能多一些少一些，数量不一致。使用<code>steps_1</code>、<code>steps_2</code>、<code>steps_3</code>固定名的 key 无法根治病痛，于是乎，想到了用序号表达之，表格也就变成了以下模样。</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>title</td> <td>大象塞进冰箱分几步</td> <td>push the elephant</td> <td>толкнуть слона</td></tr> <tr><td>steps[0]</td> <td>打开冰箱</td> <td>Free America</td> <td>заглавие</td></tr> <tr><td>steps[1]</td> <td>把大象塞进去</td> <td>shooting every day</td> <td>содержание</td></tr></tbody></table> <p>脚本将其转换为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cn&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;大象塞进冰箱分几步&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;打开冰箱&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;把大象塞进去&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...省略其他语种</span>
<span class="token punctuation">]</span>
</code></pre></div><p>那么只需要<code>for</code>遍历这个<code>steps</code>即可，不再需要大量写死的诸如 <code>steps_1</code> 的 key 。</p> <p>更复杂的情况下，列表每一项可能是描述事物，是一个对象，这就麻烦了，到了这里应该要处理普适性问题，即 excel 表格需要表达出任意结构的数据。</p> <p>回顾一下，当我们访问一个对象（结构比较深）某属性时，比如第一个 <code>elephant</code> 的第一个 <code>child</code>, 我们使用 <code>list.elephants[0].childs[0]</code> 来访问到 <code>张思</code> 。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">elephants</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'张思'</span><span class="token punctuation">,</span> <span class="token string">'张武'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么，我们用同样的方式来描述 <code>excel</code> 某行内容应该处于对象的什么位置。</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>elephants[0].name</td> <td>张三</td> <td>san zhang</td> <td></td></tr> <tr><td>elephants[0].childs[0]</td> <td>张思</td> <td>si zhang</td> <td></td></tr> <tr><td>elephants[0].childs[1]</td> <td>张武</td> <td>wu zhang</td> <td></td></tr></tbody></table> <p>脚本将其转换为</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token string">'cn'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">elephants</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'张思'</span><span class="token punctuation">,</span> <span class="token string">'张武'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...省略其他语种</span>
<span class="token punctuation">]</span>
</code></pre></div><p>至此，页面多语言管理方案尚可一战，excel 表格和 json 互转的脚本沉淀为 <a href="https://www.npmjs.com/package/json-key-string-xlsx" target="_blank" rel="noopener noreferrer">json-key-string-xlsx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="二、h5-raptor-实现"><a href="#二、h5-raptor-实现" class="header-anchor">#</a> 二、H5-Raptor 实现</h2> <h4 id="_2-1-组件多语言而非页面多语言"><a href="#_2-1-组件多语言而非页面多语言" class="header-anchor">#</a> 2.1 组件多语言而非页面多语言</h4> <p>组件化中台基于组件组装出页面，开发组件时并没有页面的概念，所以我们没法直接像上面那样处理页面多语言。
不过，基于上面的经验，可以让组件<code>捆绑</code>一个 <code>excel</code> 用于记载组件多语言，页面保存时，将多个组件的 <code>excel</code> 合并起来就好了。</p> <p>组件A</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>title</td> <td>大象塞进冰箱分几步</td> <td>push the elephant</td> <td>толкнуть слона</td></tr></tbody></table> <p>组件B</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>title</td> <td>今年过节不收礼</td> <td>Free America</td> <td>заглавие</td></tr> <tr><td>subtitle</td> <td>收礼只收脑白金</td> <td>shooting every day</td> <td>содержание</td></tr></tbody></table> <p>合并得出页面 <code>excel</code> 如下（lang字段比较特殊）</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>title</td> <td>大象塞进冰箱分几步</td> <td>push the elephant</td> <td>толкнуть слона</td></tr> <tr><td>title</td> <td>今年过节不收礼</td> <td>Free America</td> <td>заглавие</td></tr> <tr><td>subtitle</td> <td>收礼只收脑白金</td> <td>shooting every day</td> <td>содержание</td></tr></tbody></table> <p>从上面表格也能看出 key 名相撞问题，相撞来源可分为以下2种：</p> <ol><li>组件使用的 <code>key</code> 名可能重复，多个组件都使用着 <code>title</code> 这个 <code>key</code>.</li> <li>单个组件在页面内被复用多次，<code>key</code> 名必定相撞。</li></ol> <p>key 名相撞导致转换出来的 JSON 出现值覆盖现象，从而造成<code>吞噬文案</code>的问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token string">'cn'</span><span class="token punctuation">,</span>
    <span class="token comment">// title: '大象塞进冰箱分几步', // 这一行将被下一行覆盖</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'今年过节不收礼'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subtitle</span><span class="token operator">:</span> <span class="token string">'收礼只收脑白金'</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...省略其他语种</span>
<span class="token punctuation">]</span>
</code></pre></div><p>由于单个组件在页面内可能复用多次，所以在编辑页面时，这类中台往往会为加入的组件创建一个页面内唯一id（暂时叫做 hashid），以表达其组件唯一性，这样单个组件复用多次也有不一样的 hashid。</p> <p>那么，可以用该 hashid 作为命名空间前缀，合并得到的 <code>excel</code> 会是：（假设2个组件的 hashid 分别是：xh86、ab2d）</p> <table><thead><tr><th>lang</th> <th>cn</th> <th>en</th> <th>ru</th></tr></thead> <tbody><tr><td>xh86.title</td> <td>大象塞进冰箱分几步</td> <td>push the elephant</td> <td>толкнуть слона</td></tr> <tr><td>ab2d.title</td> <td>今年过节不收礼</td> <td>Free America</td> <td>заглавие</td></tr> <tr><td>ab2d.subtitle</td> <td>收礼只收脑白金</td> <td>shooting every day</td> <td>содержание</td></tr></tbody></table> <p>脚本会将其转换为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token string">'cn'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">xh86</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'大象塞进冰箱分几步'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ab2d</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'今年过节不收礼'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">subtitle</span><span class="token operator">:</span> <span class="token string">'收礼只收脑白金'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...省略其他语种</span>
<span class="token punctuation">]</span>
</code></pre></div><p>页面渲染时，将<code>xh86</code>这个 key 的值传给<code>hashid</code>为<code>xh86</code>的组件，hashid 很好的起到了隔离效果。</p> <h4 id="_2-2-多语言结构而非多语言文案"><a href="#_2-2-多语言结构而非多语言文案" class="header-anchor">#</a> 2.2 多语言结构而非多语言文案</h4> <p>如果文案信息很少的情况下，<code>直接写 json</code>会比<code>编写 excel 再转换为 json</code>更加方便。
正是因为页面多语言文案较多，页面多语言管理用后者方式更加科学。</p> <p>然后，组件化中台没有明确的页面概念，只有明确的组件，同时，组件也不知道会用在哪些语种下，此时为组件编写多语言并无多大意义，更多需要的是语言的数据结构，文案信息一般都很少，那么为组件编写 excel 反倒显得不合适。</p> <p>再重新设计一番，为每个组件仅编写中文的 json 文案。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 组件A</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'大象塞进冰箱分几步'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 组件B</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'今年过节不收礼'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">subtitle</span><span class="token operator">:</span> <span class="token string">'收礼只收脑白金'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>组件化搭建后的页面，将多个组件的文案 json 汇总起来，以组件的 hashid 为命名空间前缀，得到：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token string">'cn'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">xh86</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'大象塞进冰箱分几步'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ab2d</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'今年过节不收礼'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subtitle</span><span class="token operator">:</span> <span class="token string">'收礼只收脑白金'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>借助脚本<code>将 json 转为 excel</code>，得到如下表格交给运营。</p> <table><thead><tr><th>lang</th> <th>cn</th> <th></th> <th></th></tr></thead> <tbody><tr><td>xh86.title</td> <td>大象塞进冰箱分几步</td> <td></td> <td></td></tr> <tr><td>ab2d.title</td> <td>今年过节不收礼</td> <td></td> <td></td></tr> <tr><td>ab2d.subtitle</td> <td>收礼只收脑白金</td> <td></td> <td></td></tr></tbody></table> <p>组件化中台的页面多语言<code>把组件 json 汇总后转 excel</code>会比<code>把各个组件 excel 汇总</code>的效率更高，减少了文件IO耗时和带宽（Excel 文件一般存放 cdn）压力。</p> <h2 id="三、小结"><a href="#三、小结" class="header-anchor">#</a> 三、小结</h2> <h4 id="_3-1-页面多语言管理"><a href="#_3-1-页面多语言管理" class="header-anchor">#</a> 3.1 页面多语言管理</h4> <p>针对明确的页面，明确的语种，步骤：</p> <ol><li>基于 excel 协同编辑，把表格第一列作为 json 的 key 描述。</li> <li>借助脚本转换 excel 成 json。</li></ol> <h4 id="_3-2-组件化中台页面多语言实现"><a href="#_3-2-组件化中台页面多语言实现" class="header-anchor">#</a> 3.2 组件化中台页面多语言实现</h4> <p>无明确页面和语种，只有明确的组件，步骤：</p> <ol><li>组件自带单语种文案 json。</li> <li>为页面内每个组件创建一个页面内唯一 id，以该 id 为命名空间前缀，得到页面文案大 json。</li> <li>将页面文案大 json 转换为 excel。</li> <li>同页面多语言管理步骤。</li></ol> <h4 id="_3-3-组件化中台单语种编辑"><a href="#_3-3-组件化中台单语种编辑" class="header-anchor">#</a> 3.3 组件化中台单语种编辑</h4> <p>不是所有页面都需要实现多语言，如果语言文案编辑都走 Excel 管理，对单语种需求并不友好。
接触过配置化场景的应该知道<code>动态表单</code>，通过<code>JSON Schema</code>描述来渲染出表单UI（甚至包含逻辑），组件的<code>伸缩能力</code>便是靠此获得。</p> <p>单语种情况下，可以通过把组件单语种 json 转为 <code>JSON Schema</code>，再通过<code>动态表单</code>库实现表单渲染供运营编辑。</p> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a57d110debb421e8f677e5974da765c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p>以 Raptor 为例，通过选项切换单语种、多语种模式，多语种通过 Excel 文件管理。↓</p> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1ae1dd7eca043729f7608da0426dc15~tplv-k3u1fbpfcp-watermark.image" width="300px"> <p>如果是单语种模式，则在组件编辑面板处理：↓</p> <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2fb971b4dd346ee90eb54bbb8fde645~tplv-k3u1fbpfcp-watermark.image" width="300px"> <h2 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h2> <p>Excel 转 JSON 结构。
<img src="/docs/image/lang1.png" alt="多语言示例"></p> <p>取某个语种的渲染效果。
<img src="/docs/image/lang2.png" alt="多语言示例"></p> <p>切换语种对比。
<img src="/docs/image/lang3.png" alt="多语言示例"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有条件的团队可能有多语言管理平台，没条件的情况下可以考虑在线 excel 表格承载翻译文案。无论何种承载方式，都可以参考以上表格和 json 互转的思路。</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/16/2022, 1:55:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/proficient/communication.html" class="prev">
        组件/插件间通信
      </a></span> <span class="next"><a href="/docs/question/">
        问题汇总
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.b00f8d5a.js" defer></script><script src="/docs/assets/js/3.9b2ede99.js" defer></script><script src="/docs/assets/js/21.5e880656.js" defer></script>
  </body>
</html>
